<p align="center">
  <a >
   <img alt="zlm4j-Logo" src="doc/images/logo.jpg" width="350px">
  </a>
</p>

# ğŸ“Œ zlm4j ğŸ“Œ

[![star](https://gitee.com/aizuda/zlm4j/badge/star.svg?theme=white)](https://gitee.com/aizuda/zlm4j/stargazers)  [![fork](https://gitee.com/aizuda/zlm4j/badge/fork.svg?theme=white)](https://gitee.com/aizuda/zlm4j/members)

## ğŸ˜ç‰¹åˆ«æ³¨æ„
ç”±äºgithubé™åˆ¶æœ€å¤§æäº¤æ–‡ä»¶å¤§å°ä¸º100Mï¼Œæ‰€ä»¥linux64ä¸‹è¿è¡Œåº“åªåœ¨giteeä¸Šå­˜åœ¨ [giteeç›´è¾¾](https://gitee.com/aizuda/zlm4j)

## ğŸ˜é¡¹ç›®æ–‡æ¡£
[é£ä¹¦æ–‡æ¡£ç›´è¾¾ https://ux5phie02ut.feishu.cn/wiki/NA2ywJRY2ivALSkPfUycZFM4nUB?from=from_copylink ](https://ux5phie02ut.feishu.cn/wiki/NA2ywJRY2ivALSkPfUycZFM4nUB?from=from_copylink)
## ğŸ˜é¡¹ç›®ç®€ä»‹

**zlm4jå¼€æºæµåª’ä½“æœåŠ¡æ¡†æ¶ ZLMediaKit C Api çš„ Java å®ç°**

æ„Ÿè°¢ [@å¤æ¥š](https://github.com/xia-chu)
æä¾›äº†è¿™ä¹ˆå¥½çš„å¼€æºæµåª’ä½“æœåŠ¡æ¡†æ¶[ZLMediaKit ](https://github.com/ZLMediaKit/ZLMediaKit)

æœ¬é¡¹ç›®æ˜¯å¯¹ ZLMediaKit æä¾›çš„ C Api çš„ Java Api å°è£…(éƒ¨åˆ†å°è£…)ã€‚é‡‡ç”¨ JNA å¯¹ ZLMediaKit C Api è¿›è¡Œè§£æï¼Œå¹¶è¿›è¡Œå¾®è°ƒå’Œä¿®æ”¹ï¼ŒåŸºäº
ZLMediaKit é¡¹ç›®çš„è°ƒç”¨åŸå§‹é£æ ¼ï¼Œå„ä½ç½‘å‹å¯ä»¥å‚ç…§ ZLMediaKit åŸå§‹é¡¹ç›®æ–‡æ¡£ç¼–å†™åº”ç”¨ç¨‹åºã€‚

ä½¿ç”¨æ­¤é¡¹ç›®å¯ä»¥å®ç°ç°æœ‰é¡¹ç›®å¿«é€Ÿé›†æˆæµåª’ä½“æœåŠ¡åŠŸèƒ½ï¼Œæ— éœ€éƒ¨ç½²é¢å¤–çš„æµåª’ä½“æœåŠ¡å™¨ï¼Œåˆ©ç”¨åŸå§‹æµäº‹ä»¶å›è°ƒæ›´åŠ æ–¹ä¾¿çš„æ“ä½œæµ(
æ¨æ‹‰æµé‰´æƒã€æŒ‰éœ€æ‹‰æµã€è‡ªåŠ¨å…³æµã€è½¬åè®®ã€æˆªå›¾ã€å½•åˆ¶ã€å›½æ ‡GBæ¨æµ)

å…·ä½“å¦‚ä½•é›†æˆåˆ°é¡¹ç›®å¯ä»¥å‚è€ƒ[JMediaServer](https://gitee.com/daofuli/j_media_server)

## ğŸ˜ç‰ˆæœ¬æ›´æ–°

- v1.0.6 æ‹‰å–åŸºäº2024-05-16-masteråˆ†æ”¯å¼€å‘ 1.åˆ›å»ºæµå¢åŠ x264ç¼–ç åº“æ”¯æŒ 2.åˆ›å»ºæµå¢åŠ faacç¼–ç åº“æ”¯æŒ
- v1.0.5 æ‹‰å–åŸºäº2024-05-10-masteråˆ†æ”¯å¼€å‘ 1.å¢åŠ on_record_tså›è°ƒ 2.ä¿®æ”¹mk_mp4_infoä¸ºmk_record_info
- v1.0.4 æ‹‰å–åŸºäº2024-05-07-masteråˆ†æ”¯å¼€å‘ 1.å¢åŠ rtcç›¸å…³å›è°ƒåŠå‡½æ•°
- v1.0.3 æ‹‰å–åŸºäº2024-04-02-masteråˆ†æ”¯å¼€å‘ 1.å¢åŠ MediaSourceè·å–æºåœ°å€ æºç±»å‹ åˆ›å»ºæ—¶é—´æˆ³
- v1.0.2 æ‹‰å–åŸºäº2024-04-01-masteråˆ†æ”¯å¼€å‘ 1.å¢åŠ macç¯å¢ƒåŒ… 2.ä¿®æ”¹åŒ…ååŸŸ
- v1.0.1 æ‹‰å–åŸºäº2024-02-05-masteråˆ†æ”¯å¼€å‘ å¢åŠ æ‹‰æµä»£ç†å‚æ•°é…ç½®
- v1.0-SNAPSHOT (åˆå§‹ç‰ˆæœ¬)æ‹‰å–åŸºäº2023-11-23-masteråˆ†æ”¯å¼€å‘

## ğŸ˜SDKåŠŸèƒ½

- **æµåª’ä½“æœåŠ¡**ï¼šæ”¯æŒè‡ªå®šä¹‰HTTP/RTSP/RTMPæµåª’ä½“æœåŠ¡ç«¯å£ï¼Œæ”¯æŒåŸç”ŸZLMediaKitå„ç§é…ç½®
- **æ¨æµåŠŸèƒ½**ï¼šæ”¯æŒZLMediaKitæä¾›çš„RTSP/RTMP/RTC/SRT/GB28181/WebRTCç­‰åè®®æ¨æµï¼Œæ”¯æŒæ¨æµé‰´æƒ
- **æ‹‰æµåŠŸèƒ½**ï¼šæ”¯æŒRTSP/RTMP/HTTP-FLV/WS-FLV/WS-HLS/FMP4ç­‰æµåè®®è¾“å‡º
- **æµä»£ç†åŠŸèƒ½**ï¼šæ”¯æŒRTSP/RTMP/HTTP-FLV/HLSç­‰æµæ¥å…¥ï¼Œæ”¯æŒæ‹‰æµé‰´æƒã€æŒ‰éœ€æ‹‰æµã€æ— äººè§‚çœ‹è‡ªåŠ¨å…³æµã€æµé‡ç»Ÿè®¡
- **å½•åˆ¶åŠŸèƒ½**ï¼šæ”¯æŒå½•åˆ¶MP4/FLV/M3U8ç­‰æ ¼å¼ï¼Œæ”¯æŒMP4åˆ†ç‰‡å¤§å°æ§åˆ¶
- **äº‹ä»¶**ï¼šæ”¯æŒæµä¸Šä¸‹çº¿ã€æ¨æ‹‰æµã€æµå½•åˆ¶å®Œæˆã€æ— äººè§‚çœ‹ã€RTSPé‰´æƒç­‰å›è°ƒ

## ğŸ˜é¡¹ç›®ç»„æˆ

1. æœ¬é¡¹ç›®å·²åŒ…å«æ‰€éœ€çš„win64/linux64åŠ¨æ€é“¾æ¥åº“mk_api.dll\libmk_api.so å¦‚éœ€å…¶ä»–ç‰ˆæœ¬è¯·æ‹‰å–å¯¹åº”ç‰ˆæœ¬ç¼–è¯‘
2. ç›¸å…³é…ç½®é¡¹åŠç¿»è¯‘åœ¨resources/conf.iniä¸­ï¼Œé…ç½®æ–¹å¼å‚è§ç¤ºä¾‹ä»£ç ï¼Œæˆ–è€…å¯¼å…¥é…ç½®æ–‡ä»¶
3. æœ¬é¡¹ç›®åŒ…å« coreã€callbackã€structure æ¨¡å—

- **core**ï¼šä¸ºæ ¸å¿ƒæ¨¡å—ï¼Œå°è£…å¸¸ç”¨å¤§éƒ¨åˆ† APIï¼Œå¦‚æœ‰æ²¡æœ‰æ·»åŠ æƒ³è¦çš„ï¼Œå¯ä»¥æ·»åŠ å¯¹åº”çš„ API åˆ° ZLMApi
- **callback**ï¼šå¯¹åº” C Api ä¸­å›è°ƒ
- **structure**ï¼šå¯¹åº” C Api ä¸­ç»“æ„ä½“ æ³¨æ„ç”±äº C Api ä¸­ç»“æ„ä½“ä¸ºç©ºï¼Œæ‰€ä»¥ dwSize ä¸ºæ·»åŠ çš„é»˜è®¤å‚æ•°ï¼Œå¦åˆ™è¿è¡Œä¼šæŠ¥é”™

## ğŸ˜ç¤ºä¾‹ä»£ç 

``` java
public class Test {
    //åŠ¨æ€é“¾æ¥åº“æ”¾åœ¨/resource/win32-x86-64&/resource/linux-x86-64ä¸‹JNAä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›®å½•
    public static ZLMApi ZLM_API = Native.load("mk_api", ZLMApi.class);
    //Windowsç¯å¢ƒæµ‹è¯•
    //public static ZLMApi ZLM_API = Native.load("E:\\ZLMediaKit\\release\\windows\\Debug\\mk_api.dll", ZLMApi.class);
    //Linuxç¯å¢ƒæµ‹è¯•
    //public static ZLMApi ZLM_API = Native.load("/opt/media/libmk_api.so", ZLMApi.class);

    public static void main(String[] args) throws InterruptedException {
        //åˆå§‹åŒ–ç¯å¢ƒé…ç½®
        MK_INI mkIni = ZLM_API.mk_ini_default();
        //é…ç½®å‚æ•° å…¨éƒ¨é…ç½®å‚æ•°åŠè¯´æ˜è§(resources/conf.ini) æ‰“å¼€è‡ªåŠ¨å…³æµ å¯¹åº”conf.iniä¸­é…ç½®[protocol]
        ZLM_API.mk_ini_set_option(mkIni, "general.mediaServerId", "JMediaServer");
        ZLM_API.mk_ini_set_option(mkIni, "http.notFound", "<h1 style=\"text-align:center;\">Media Server V1.0 By LiDaoFu</h1>");
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.auto_close",0);
        ZLM_API.mk_ini_set_option_int(mkIni, "general.streamNoneReaderDelayMS", 30000);
        ZLM_API.mk_ini_set_option_int(mkIni, "general.maxStreamWaitMS", 30000);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_ts", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_hls",1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_fmp4", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_rtsp", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_rtmp", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_mp4", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_hls_fmp4", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.enable_audio", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.mp4_as_player", 1);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.mp4_max_second", 3600);
        ZLM_API.mk_ini_set_option(mkIni, "http.rootPath","D:/www");
        ZLM_API.mk_ini_set_option(mkIni, "protocol.mp4_save_path", "D:/www");
        ZLM_API.mk_ini_set_option(mkIni, "protocol.hls_save_path","D:/www");
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.hls_demand", 0);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.rtsp_demand", 0);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.rtmp_demand", 0);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.ts_demand", 0);
        ZLM_API.mk_ini_set_option_int(mkIni, "protocol.fmp4_demand", 0);
        //å…¨å±€å›è°ƒ å…¨éƒ¨å›è°ƒè§MK_EVENTSå†…æ‰€æœ‰çš„å›è°ƒå±æ€§ï¼Œæœ‰äº›éœ€è¦å»å®ç°ï¼Œä¸ç„¶æµæ— æ³•æ’­æ”¾æˆ–è€…æ— æ³•æ¨æµ
        MK_EVENTS mkEvents = new MK_EVENTS();
        //æµçŠ¶æ€æ”¹å˜å›è°ƒ
        mkEvents.on_mk_media_changed = (regist, sender) -> {
            System.out.println("app:"+ZLM_API.mk_media_source_get_app(sender));
            System.out.println("stream:"+ZLM_API.mk_media_source_get_stream(sender));
            System.out.println("schema:"+ZLM_API.mk_media_source_get_schema(sender));
            System.out.println("è¿™é‡Œæ˜¯æµæ”¹å˜å›è°ƒé€šçŸ¥:" + regist);
        };
        //æ— äººè§‚çœ‹å›è°ƒ
        mkEvents.on_mk_media_no_reader = sender -> {
            System.out.println("è¿™é‡Œæ˜¯æ— äººè§‚çœ‹å›è°ƒé€šçŸ¥");
            ZLM_API.mk_media_source_close(sender, 1);
        };
        //æ¨æµå›è°ƒ å¯æ§åˆ¶é‰´æƒã€å½•åˆ¶ã€è½¬åè®®æ§åˆ¶ç­‰
        mkEvents.on_mk_media_publish = (url_info, invoker, sender) -> {
            //è¿™é‡Œæ‹¿åˆ°è®¿é—®è·¯å¾„å(ä¾‹å¦‚rtmp://xxxx/xxx/xxx?token=xxxxå…¶ä¸­?åé¢å°±æ˜¯æ‹¿åˆ°çš„å‚æ•°)çš„å‚æ•°
            // err_msgè¿”å› ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé‰´æƒæˆåŠŸ å¦åˆ™é‰´æƒå¤±è´¥æç¤º
            //String param = ZLM_API.mk_media_info_get_params(url_info);
            ZLM_API.mk_publish_auth_invoker_do(invoker, "", 0, 0);
        };
        //æ·»åŠ å…¨å±€å›è°ƒ
        ZLM_API.mk_events_listen(mkEvents);
        //Pointer iniPointer = ZLM_API.mk_ini_dump_string(mkIni);
        //åˆå§‹åŒ–zmkæœåŠ¡å™¨
        ZLM_API.mk_env_init1(1, 1, 1, null, 0, 0, null, 0, null, null);
        //åˆ›å»ºhttpæœåŠ¡å™¨ 0:å¤±è´¥,é0:ç«¯å£å·
        short http_server_port = ZLM_API.mk_http_server_start((short) 7788, 0);
        //åˆ›å»ºrtspæœåŠ¡å™¨ 0:å¤±è´¥,é0:ç«¯å£å·
        short rtsp_server_port = ZLM_API.mk_rtsp_server_start((short) 554, 0);
        //åˆ›å»ºrtmpæœåŠ¡å™¨ 0:å¤±è´¥,é0:ç«¯å£å·
        short rtmp_server_port = ZLM_API.mk_rtmp_server_start((short) 1935, 0);
        //åˆ›å»ºRTCæœåŠ¡å™¨ 0:å¤±è´¥,é0:ç«¯å£å·
        short rtc_server_port = ZLM_API.mk_rtc_server_start((short)8000);
        /*****************************ä¸‹é¢ä¸ºæ¨æµåŠæ’­æ”¾********************************/
        // æ¨æµï¼šåˆ©ç”¨obsã€ffmpeg è¿›è¡Œæ¨æµ RTMPæ¨æµï¼šrtmp://127.0.0.1:rtmp_port/æµAPP/æµåç§°  RTSPæ¨æµï¼šrtsp://127.0.0.1:rtsp_port/æµAPP/æµåç§°
        // ä¸‹é¢æ˜¯å„åè®®æ‹‰æµæ’­æ”¾çš„è®¿é—®æ ¼å¼
        // HTTP-FLVæ‹‰æµï¼šhttp://ip:http_port/æµAPP/æµåç§°.live.flv
        // WS-FLVæ‹‰æµï¼šws://ip:http_port/æµAPP/æµåç§°.live.flv
        // HLSæ‹‰æµï¼šhttp://ip:http_port/æµAPP/æµåç§°/hls.m3u8
        // RTMPæ‹‰æµï¼šrtmp://ip:rtmp_port/æµAPP/æµåç§°
        // RTSPæ‹‰æµï¼šrtsp://ip:rtsp_port/æµAPP/æµåç§°
        /*****************************ä¸‹é¢ä¸ºæµä»£ç†æ¼”ç¤º********************************/
        //åˆ›å»ºæ‹‰æµä»£ç†
        MK_INI option = ZLM_API.mk_ini_create();
        ZLM_API.mk_ini_set_option_int(option,"hls_enabled",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_mp4",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_audio",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_fmp4",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_ts",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_hls",0);
        ZLM_API.mk_ini_set_option_int(option,"enable_rtsp",1);
        ZLM_API.mk_ini_set_option_int(option,"enable_rtmp",1);
        ZLM_API.mk_ini_set_option_int(option,"mp4_max_second",3600);
        //ZLM_API.mk_ini_set_option(option,"mp4_save_path","D:/record");
        //ZLM_API.mk_ini_set_option(option,"hls_save_path","D:/record");
        ZLM_API.mk_ini_set_option_int(option,"add_mute_audio",0);
        ZLM_API.mk_ini_set_option_int(option,"auto_close",1);
        MK_PROXY_PLAYER mk_proxy = ZLM_API.mk_proxy_player_create2("__defaultVhost__", "live", "test",option );
        //å¼€å§‹æ’­æ”¾
        ZLM_API.mk_proxy_player_play(mk_proxy, "rtsp://admin:hk123456@192.168.1.64/h264/ch1/sub/av_stream");
        ZLM_API.mk_ini_release(option);
        //å›è°ƒå…³é—­äº‹ä»¶
        IMKProxyPlayCloseCallBack imkProxyPlayCloseCallBack = new IMKProxyPlayCloseCallBack() {
            @Override
            public void invoke(Pointer pUser, int err, String what, int sys_err) {
                //è¿™é‡ŒPointeræ˜¯ZLMç»´æŠ¤çš„ä¸éœ€è¦æˆ‘ä»¬é‡Šæ”¾ éµå¾ªè°ç”³è¯·è°é‡Šæ”¾åŸåˆ™
                ZLM_API.mk_proxy_player_release(new MK_PROXY_PLAYER(pUser));
            }
        };
        //æ·»åŠ ä»£ç†å…³é—­å›è°ƒ å¹¶æŠŠä»£ç†å®¢æˆ·ç«¯ä¼ è¿‡å»é‡Šæ”¾
        ZLM_API.mk_proxy_player_set_on_close(mk_proxy, imkProxyPlayCloseCallBack, mk_proxy.getPointer());
        /*****************************end********************************/
        //é˜»å¡60s
        Thread.sleep(60000L);
        //åœæ­¢æ‰€æœ‰æœåŠ¡å™¨
        ZLM_API.mk_stop_all_server();
    }
}



```

## ğŸ˜é›†æˆé¡¹ç›®

1. å¯ç›´æ¥å¤åˆ¶ä»£ç åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œæ–¹ä¾¿ä¿®æ”¹å‚æ•°è¿›è¡ŒäºŒæ¬¡å¼€å‘

2. ç”±äºæ­¤é¡¹ç›®æš‚æœªå‘å¸ƒåˆ°ä¸­å¤®ä»“åº“ï¼Œå¯ä»¥ä¸‹è½½æ­¤é¡¹ç›®ç„¶åæ‰“åŒ…åˆ°æœ¬åœ°ä»“åº“ï¼ˆmvn installï¼‰ç„¶åé¡¹ç›®å¼•å…¥

``` xml
        <dependency>
            <groupId>com.aizuda</groupId>
            <artifactId>zlm4j</artifactId>
            <version>1.0.6</version>
        </dependency>
```

## ğŸ˜å¸¸è§é—®é¢˜

1. å‚è§[ZLM4Jå¸¸è§é—®é¢˜ ](https://ux5phie02ut.feishu.cn/wiki/SzIAwyxnpilVMlkccS4cfJFGn1g)

## ğŸ˜å­¦ä¹ æ¢è®¨

 <p align="center">
  <a >
   <img alt="zlm4j-qun" src="doc/images/qun.jpg" width="350px">
  </a>
</p>
